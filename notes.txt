# --- debug file ---
typeset -g SHORT_BRANCH_DEBUG=/tmp/zsh_git_branch_debug.log

# Helper: extract ticket key like NT-123 from any branch name
function _shorten_ticket() {
  emulate -L zsh
  local base=${1##*/}   # trim refs like feature/, bugfix/
  if [[ $base =~ ([A-Za-z][A-Za-z0-9]*-[0-9]+) ]]; then
    print -r -- ${match[1]}
  else
    print -r -- $base
  fi
}

# Override robbyrussell's git segment with a shortened branch name
function git_prompt_info() {
  emulate -L zsh
  local b short gp_status
  b=$(
    command git symbolic-ref --quiet --short HEAD 2>/dev/null ||
    command git describe --tags --exact-match 2>/dev/null ||
    command git rev-parse --short HEAD 2>/dev/null
  ) || return

  short=$(_shorten_ticket "$b")

  if typeset -f git_prompt_status >/dev/null; then
    gp_status="$(git_prompt_status)"
  fi

  print -r -- "IN:[$b] OUT:[$short] STATUS:[$gp_status]" >> $SHORT_BRANCH_DEBUG
  print -r -- "${ZSH_THEME_GIT_PROMPT_PREFIX}${short}${gp_status}${ZSH_THEME_GIT_PROMPT_SUFFIX}"
}
